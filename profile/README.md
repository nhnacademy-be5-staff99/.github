![header](https://capsule-render.vercel.app/api?type=waving&height=250&color=DBD5D1&text=Store99st&fontAlignY=32&desc=from%20CNU-NHN%20Academy&descAlignY=50)

# 📖 온라인 서점, Store99st
**배포 url :** https://store99st.shop

**Github :** https://github.com/nhnacademy-be5-staff99

**개발 기간 :** 2024.03.01 - 2024.05.22

**컨벤션 :** [convention.md](https://github.com/nhnacademy-be5-staff99/.github/blob/main/convention.md)

<br>

# Members

|<img src="https://avatars.githubusercontent.com/u/19241369?v=4" width= 80>|<img src="https://avatars.githubusercontent.com/u/86106442?v=4" width = 80>|<img src="https://avatars.githubusercontent.com/u/114563915?v=4" width = 80>|<img src="https://avatars.githubusercontent.com/u/138862600?v=4" width = 80>|<img src="https://avatars.githubusercontent.com/u/134525851?v=4" width = 80>|<img src="https://avatars.githubusercontent.com/u/148544516?v=4" width=80>|
|:---:|:---:|:---:|:---:|:---:|:---:|
|[김승규](https://github.com/seung-gyu-kim)|[노동영](https://github.com/yrrho2)|[송아현](https://github.com/SongAhyeon01)|[송진규](https://github.com/Rosin23)|[이서연](https://github.com/SeoYeonLee12)|[진효겸](https://github.com/jinhyogyeom)|
| 게이트웨이/유레카 | 로그 | 인증/로그인 | 태그 | 좋아요 | 회원 가입 |
| 카테고리 | 도서 | 마이페이지 | 포인트 | 리뷰 | 검색 |
| 장바구니 | | 검색 ||||
| 주문/결제 | | 쿠폰 ||||


<br>

# 🌏 Development Environment
### 개발 도구
![intellijidea](https://img.shields.io/badge/Intellij-000000?style=for-the-badge&logo=intellijidea&logoColor=white)

### 개발 언어
![Java](https://img.shields.io/badge/Java%2011-ED8B00?style=for-the-badge&logo=openjdk&logoColor=white)

### 빌드 도구
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/134525851/46dd7801-40a8-4161-8ecd-ac04bb56ccb7)

### 개발
![Spring](https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white) ![SpringBoot](https://img.shields.io/badge/Spring%20Boot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white) ![SpringSecurity](https://img.shields.io/badge/Spring%20Security-6DB33F?style=for-the-badge&logo=springsecurity&logoColor=white) ![SpringCloud](https://camo.githubusercontent.com/50acff628faae8cd4a63534f928755f865997bfee8c9949760f845ae410adf42/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f737072696e6720636c6f75642d3644423333463f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465) 
![Spring Cloud Netflix](https://camo.githubusercontent.com/b6aea98627db04aa6fac0fd0d0c7980001b408e6233a8ce0b544875224e0ef52/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f737072696e6720657572656b612d3644423333463f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465) ![Spring Cloud Gateway](https://github.com/nhnacademy-be5-staff99/.github/assets/134525851/bf0afbfc-52bd-4740-a228-64bc23f38a96) ![JPA](https://camo.githubusercontent.com/ad89845598b64900527549a5733ea06f7d687b837660cc1a19cf3936b6a137f6/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f737072696e672044617461204a50412d3644423333463f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465) ![RestDocs](https://camo.githubusercontent.com/452f67ab6a315f728dc0df6fa9fa52da768616b1d85404da7cbda1b89912e340/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f737072696e672052455354646f63732d3644423333463f7374796c653d666f722d7468652d6261646765266c6f676f3d737072696e67266c6f676f436f6c6f723d7768697465)

### 테스트
![SonarQube](https://camo.githubusercontent.com/1d11326da30b682f9d477137beab882521d0f5652cf868944da864e2706d026a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f736f6e6172717562652d3445394243443f7374796c653d666f722d7468652d6261646765266c6f676f3d536f6e617251756265266c6f676f436f6c6f723d7768697465) ![image](https://github.com/nhnacademy-be5-staff99/.github/assets/134525851/08919490-0ae8-4772-9b7a-cf60c9317f01)

### DB
![Mysql](https://img.shields.io/badge/Mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white) ![Redis](https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=redis&logoColor=white)

### 검색엔진
![ElasticSearch](https://camo.githubusercontent.com/88a4634ac0ccc183ed33b315478f53c202b6cfea2f91f92b1a50f8b5a2c78951/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f456c61737469635f5365617263682d3030353537313f7374796c653d666f722d7468652d6261646765266c6f676f3d656c6173746963736561726368266c6f676f436f6c6f723d7768697465)

### Cloud
![cloud](https://camo.githubusercontent.com/c7370d931706a4b3f95c94afe2df776f8ab6ce7555b7920e2f4e9a62d79d76c0/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f2d4e484e253230436c6f75642d626c75653f7374796c653d666f722d7468652d6261646765266c6f676f3d69436c6f7564266c6f676f436f6c6f723d7768697465)

### Message Queue
![RabbitMQ](https://img.shields.io/badge/rabbitmq-%23FF6600.svg?&style=for-the-badge&logo=rabbitmq&logoColor=white)

### 협업도구
![GithubProject](https://camo.githubusercontent.com/fd499f0e176b319238be1f69a8baf80399cfbf5c4d3bc9e4717ca4c83960bb31/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769746875622d3138313731373f7374796c653d666f722d7468652d6261646765266c6f676f3d676974687562266c6f676f436f6c6f723d7768697465)

### 배포
![Github](https://img.shields.io/badge/GitHub%20Action-100000?style=for-the-badge&logo=github&logoColor=white) ![Linux](https://img.shields.io/badge/Linux-FCC624?style=for-the-badge&logo=linux&logoColor=black)

### ECT
![Gmail](https://img.shields.io/badge/Gmail-EA4335?style=for-the-badge&logo=gmail&logoColor=white) ![kakao](https://img.shields.io/badge/Kakao-FFCD00?style=for-the-badge&logo=kakao&logoColor=black) ![JWT](https://camo.githubusercontent.com/138db798f7f1539dfa9daf51b867e320ca9fe0381dc64660974761449290c79a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4a57542d3030303030303f7374796c653d666f722d7468652d6261646765266c6f676f3d6a736f6e776562746f6b656e73266c6f676f436f6c6f723d7768697465)

### CI/CD
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/134525851/c4b7f34e-ea51-4199-966a-550bf71f6d45) ![Jenkins](https://img.shields.io/badge/Jenkins-D24939?style=for-the-badge&logo=Jenkins&logoColor=white)

### UI
![Bootstrap](https://img.shields.io/badge/Bootstrap-563D7C?style=for-the-badge&logo=bootstrap&logoColor=white)

### Front
![Thymleaf](https://camo.githubusercontent.com/e1ad5eb422f04c6da31adacb553ce03975081d0987e58cec5ad00be07272bf54/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7468796d656c6561662d3030354630463f7374796c653d666f722d7468652d6261646765266c6f676f3d7468796d656c656166266c6f676f436f6c6f723d7768697465) ![HTML](https://camo.githubusercontent.com/d30449fa2dbae519940a0d08f0202996163310b8c6b9336480232cfb48d38286/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f68746d6c352d4533344632363f7374796c653d666f722d7468652d6261646765266c6f676f3d68746d6c35266c6f676f436f6c6f723d7768697465) ![CSS](https://github.com/nhnacademy-be5-staff99/.github/assets/134525851/9aa807e7-95d3-4691-91e5-5dc77f515784) ![image](https://github.com/nhnacademy-be5-staff99/.github/assets/134525851/420f9542-cd7c-4e9c-a405-4d1f0d4f0277)

# 🏗️ Project Architecture
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/19241369/e5cd4657-a4c7-46bb-a2f4-49dc1b8e7b62)

# 🚀 CI/CD
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/19241369/fb136326-fc08-4d13-ac7a-1bb282e700da)

# 💿 ERD
![STORE99 V1 6](https://github.com/nhnacademy-be5-staff99/.github/assets/114563915/75dd00a7-227e-494e-902f-db47aef8746a)


# 🤖 Project Management
> Github의 기능 `Projects`를 사용하여 프로젝트 관리

### [WBS](https://github.com/orgs/nhnacademy-be5-staff99/projects/1/views/1)
Github Project 로 각 작업마다 이슈로 등록하여 관리
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/114563915/86015f30-869f-4652-88b4-a781ab41aa64)


### [Roadmap - 일정관리](https://github.com/orgs/nhnacademy-be5-staff99/projects/1/views/6)
Github Project 의 Roadmap 을 이용한 멤버별 일정 관리
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/114563915/9773dc2c-c6bf-4e76-8d65-a936c49c2cb1)


### [Board - 작업 관리](https://github.com/orgs/nhnacademy-be5-staff99/projects/1/views/3)

Github Project 의 Board 을 이용한 멤버별 작업 관리
- Todo, InProgress, CodeReview, Delay, Done 으로 나누어 상태 확인
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/114563915/9caeed8c-b0e3-4ec9-9f94-5e3383db2516)


### [Scrum](https://github.com/orgs/nhnacademy-be5-staff99/projects/1/views/7)
Scrum 을 Github Issue 로 관리
- 주마다 Scrum Master를 변경하고 투표를 통해 마지막 2주의 Scrum Master를 고정
- 매일 09시에 스크럼을 진행. 특이사항 발생시 Scrum Master를 통하여 일정 변경
- 팀원간 진행사항과 그 날의 Task를 정리하고 특이사항을 공유함으로써 팀원간 협력적이고 체계적인 프로젝트 진행
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/114563915/1f59922a-2bd8-4e2b-bfd0-0f9c413e3937)

### 이슈 관리
- 에러나 버그 등 이슈 발생 시 Github Issue 로 등록하여 Github Projects에서 관리
- 다른 팀원의 이슈 발견시 Github Issue 생성 후 Assignees에 등록하여 건의
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/86106442/b6562dba-faa7-4813-9829-4e846ae6150b)
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/86106442/a53f41bc-89b1-47c5-b643-eeae8275725a)

### Code Review
- 각각의 팀원은 다른 2명의 Pull Request 코드리뷰를 컨벤션 규칙에 따라 성실히 수행 [컨벤션: 코드리뷰 규칙](https://github.com/nhnacademy-be5-staff99/.github/blob/main/convention.md#%EC%BD%94%EB%93%9C%EB%A6%AC%EB%B7%B0)
- Pull Request의 수정사항과 관련된 팀원은 임의로 리뷰어에 추가, 변경 될 수 있음
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/86106442/e01df437-bf73-4a89-9f6e-823541322ff2)

### [기술 공유](https://github.com/orgs/nhnacademy-be5-staff99/projects/1/views/12)
팀원간의 협업과 개발의 효율을 상승시키기 위해 각자 학습한 기술을 WBS Issue로 등록, 작성하여 공유
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/86106442/bc528076-ef31-4f81-a5dd-427feca8d7ba)

# 🧪 Test
## Test Coverage
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/114563915/a32ecc47-f88f-45bc-b6d1-7f5ae523ec03)


## Black Box Test
- 매 주 개발내용을 배포 시 페이지의 모든 동작을 검사
- 기존 기능과 새로 배포되는 기능을 중점적으로 사이드 이펙트 유무 파악
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/86106442/5f1e3a32-51f2-4df5-a6d4-259898f4c3bc)

### [배포](https://github.com/orgs/nhnacademy-be5-staff99/projects/1/views/13)
![image](https://github.com/nhnacademy-be5-staff99/.github/assets/86106442/bf307fd8-c4bc-4b60-a066-9e306d7620be)

## White Box Test(Unit Test)
### Controller Test
RestDocSupport와 @WebMvcTest를 활용하여 Controller 단위 테스트 구현

#### RestDocSupport.java
Spring REST Docs을 위한 기능과 관리자 권한을 반환하는 서비스를 Mocking하는 기능이 들어있는 컨트롤러 테스트 지원을 위한 클래스
```java
/**
 * Rest docs를 편리하게 사용하기 위한 Support 클래스
 * @author seunggyu-kim 
 */
@Disabled
@Import(RestDocsConfig.class)
@ExtendWith({RestDocumentationExtension.class})
public abstract class RestDocSupport {
    @Autowired
    protected MockMvc mockMvc;

    @Autowired
    protected ObjectMapper objectMapper;

    @Autowired
    protected RestDocumentationResultHandler restDoc;

    // 관리자 여부 테스트 용으로 사용
    // ex) BDDMockito.given(adminCheckService.isAdmin(Mockito.anyLong())).willReturn(true);
    @MockBean
    protected AdminCheckService adminCheckService;

    /**
     * Spring Rest Docs를 사용하기 위한 설정
     *
     * @param webApplicationContext
     * @param restDocumentationContextProvider
     */
    @BeforeEach
    public void setup(
            final WebApplicationContext webApplicationContext,
            final RestDocumentationContextProvider restDocumentationContextProvider
    ) {
        this.mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext)
                .apply(MockMvcRestDocumentation.documentationConfiguration(restDocumentationContextProvider))
                .alwaysDo(MockMvcResultHandlers.print())
                .alwaysDo(restDoc)
                .addFilters(new CharacterEncodingFilter("UTF-8", true))     // 한글 깨짐 방지 처리
                .build();
    }
}
```
#### 컨트롤러 테스트 예시(AdminCheckControllerTest.java)
given, when, then으로 나누어 BDD 방식으로 구현
```java
@WebMvcTest(AdminCheckController.class)
class AdminCheckControllerTest extends RestDocSupport {
    /**
     * 관리자 여부 확인 테스트
     * <p>사용자가 관리자 권한을 갖고있는 경우
     *
     * @throws Exception
     */
    @DisplayName("관리자 여부 확인 - 관리자인 경우")
    @Test
    void checkAdmin_true() throws Exception {
        // given
        Long userId = Mockito.anyLong();
        BDDMockito.given(adminCheckService.isAdmin(userId)).willReturn(true);

        // when
        String response = mockMvc.perform(
                        MockMvcRequestBuilders.get("/v1/admin/check")
                                .header("X-USER-ID", userId))
                .andExpectAll(
                        MockMvcResultMatchers.status().isOk()
                )
                .andReturn().getResponse().getContentAsString();

        // then
        CommonHeader commonHeader = CommonHeader.builder().httpStatus(HttpStatus.OK).resultMessage("Success").build();
        CommonResponse<AdminCheckResponse> commonResponse =
                CommonResponse.<AdminCheckResponse>builder().header(commonHeader).result(new AdminCheckResponse(true))
                        .build();
        String expected = objectMapper.writeValueAsString(commonResponse);
        Assertions.assertThat(response).isEqualTo(expected);
    }
    ...(생략)
}
```

### Service Test
@ExtendWith(MockitoExtension.class)를 활용하여 Service 단위 테스트 구현
- given, when, then으로 나누어 BDD 방식으로 구현
- MockedStatic을 이용하여 XUserIdThreadLocal에 저장된 xUserId 변경
```java
@ExtendWith(MockitoExtension.class)
class CartServiceImplTest {
    @InjectMocks
    private CartServiceImpl cartService;
    @Mock
    private CartRepository cartRepository;
    @Mock
    private UserRepository userRepository;
    @Mock
    private BookRepository bookRepository;

    ...(생략)...

    @Test
    @DisplayName("장바구니에 책 추가 - 책이 없을 경우")
    void addBookToCartWhenBookNotFound() {
        try (MockedStatic<XUserIdThreadLocal> utilities = mockStatic(XUserIdThreadLocal.class)) {
            // given
            CartItemRequest request = new CartItemRequest(1L, 1);
            given(XUserIdThreadLocal.getXUserId()).willReturn(1L);
            given(cartRepository.findByUser_IdAndBook_Id(1L, 1L)).willReturn(Optional.empty());
            given(userRepository.findById(1L)).willReturn(Optional.of(User.builder().id(1L).build()));
            given(bookRepository.findById(1L)).willReturn(Optional.empty());

            // when & then
            assertThatThrownBy(() -> cartService.addBookToCart(request))
                    .isInstanceOf(CartBadRequestException.class)
                    .hasMessageContaining("Book not found (book id: 1)");
            verify(cartRepository, never()).save(Mockito.any(Cart.class));
        }
    }
}
```

### Repository Test
@DataJpaTest를 활용하여 Repository 단위 테스트 구현
- given, when, then으로 나누어 BDD방식으로 테스트

```java
@DataJpaTest
class CartRepositoryImplTest {
    @Autowired
    private TestEntityManager entityManager;

    @Autowired
    private CartRepository cartRepository;

    private User user;
    private Book book1;
    private Book book2;

    @BeforeEach
    void setUp() {
        Grade grade = Grade.builder()
                .gradeName("BASIC")
                .gradeStartCost(0)
                .gradeEndCost(1000000)
                .gradeRatio(10)
                .build();
        entityManager.persist(grade);

        Auth auth = Auth.builder()
                .authName("USER")
                .build();
        entityManager.persist(auth);

        Consumer consumer = Consumer.builder()
                .consumerName("consumer name")
                .consumerEmail("user@naver.com")
                .consumerPhone("01012345678")
                .consumerPassword("$2a$12$S7/5PoUN5HtdFEGZoEByg.BF45kovwhZaiR5fKwXtrXmJ.QlfGd7S")
                .build();
        entityManager.persist(consumer);

        user = User.builder()
                .userBirthdate(LocalDate.parse("2007-12-03"))
                .grade(grade)
                .auth(auth)
                .consumers(consumer)
                .build();
        entityManager.persist(user);

        book1 = Book.builder()
                .bookIsbn13("1234567890123")
                .bookIsbn10("1234567890")
                .bookTitle("book title1")
                .bookContents("book contents1")
                .bookDescription("book description1")
                .bookPublisher("book publisher")
                .bookDate(LocalDateTime.parse("2007-12-03T10:15:30"))
                .bookPrice(10000)
                .bookSalePrice(9000)
                .bookIsPacked(false)
                .bookThumbnailUrl("https://via.placeholder.com/200x303")
                .build();
        entityManager.persist(book1);

        book2 = Book.builder()
                .bookIsbn13("9234567890123")
                .bookIsbn10("9234567890")
                .bookTitle("book title2")
                .bookContents("book contents2")
                .bookDescription("book description2")
                .bookPublisher("book publisher")
                .bookDate(LocalDateTime.parse("2007-12-03T10:15:30"))
                .bookPrice(20000)
                .bookSalePrice(15000)
                .bookIsPacked(false)
                .bookThumbnailUrl("https://via.placeholder.com/200x303")
                .build();
        entityManager.persist(book2);
    }

    @Test
    @DisplayName("사용자 ID로 장바구니 아이템 조회")
    void getCartItemsByUser() {
        // given
        Cart cart1 = Cart.builder()
                .cartAmount(1)
                .user(user)
                .book(book1)
                .build();
        entityManager.persist(cart1);

        Cart cart2 = Cart.builder()
                .cartAmount(2)
                .user(user)
                .book(book2)
                .build();
        entityManager.persist(cart2);

        // when
        List<CartItemResponse> cartItemResponses = cartRepository.getCartItemsByUser(user.getId());

        // then
        List<CartItemResponse> expectedCartItemResponses = new ArrayList<>();
        CartItemResponse expectedCartItemResponse1 = new CartItemResponse(
                book1.getId(),
                book1.getBookTitle(),
                book1.getBookPrice(),
                book1.getBookSalePrice(),
                book1.getBookThumbnailUrl(),
                book1.getBookStock(),
                cart1.getCartAmount()
        );
        expectedCartItemResponses.add(expectedCartItemResponse1);
        CartItemResponse expectedCartItemResponse2 = new CartItemResponse(
                book2.getId(),
                book2.getBookTitle(),
                book2.getBookPrice(),
                book2.getBookSalePrice(),
                book2.getBookThumbnailUrl(),
                book2.getBookStock(),
                cart2.getCartAmount()
        );
        expectedCartItemResponses.add(expectedCartItemResponse2);

        assertThat(cartItemResponses).usingRecursiveComparison().isEqualTo(expectedCartItemResponses);
    }
}
```

# 🖐️ Member Role
## 공통
- 프로젝트 요구사항 분선
- WBS 작성
- DB 설계
- CI/CD 환경 구축
- API 스펙 정의
- 도메인 준비
- 화면 구성
- 팀 규칙 정립
- 역할 분담

## 김승규
### 카테고리
### 장바구니
### 주문
### 결제

### 기타
- 코드 스타일 정립 / Git 컨벤션 통일 / PR 및 팀 규칙 정립
  - [convention.md](https://github.com/nhnacademy-be5-staff99/.github/blob/main/convention.md)
- JPA 엔티티
- Spring REST docs
- API 서버에서 UserId와 권한 관련 공통화
- 응답 객체 제작 및 ResponseBodyAdvice 이용한 공통화
- 관리자 권한 검사

## 노동영
### Front Server 이 중화, SSL 설정
- 팀 Domain의 SSL 인증서를 NGINX에 적용하여 HTTPS통신 활성화
- Front Server를 NHN LoadBalancer에 연결하여 이중화
### Logging
- Repository에 NHN Cloud Log&Crash을 적용하여 클라우드에서 인스턴스 로그 검색 가능
- 프로젝트에 로깅 적용 정리 후 Github Projects에 기술공유 Issue 공유
   - https://github.com/nhnacademy-be5-staff99/store99-ect/issues/16
### 도서
- Query Dsl, Pageable, fetch join, DTO projection, Transform을 사용한 도서 데이터 사용
- 카테고리기준으로 도서 검색
- 도서 상세페이지 조회 가능
- 인덱스 페이지에 베스트, 신상 도서 추가 (진행중)

## 송아현
### 인증/인가
### 마이페이지
### 단순 검색
### 쿠폰

## 송진규
### 태그
### 포인트

### 기타
- 템플릿 정하기

## 이서연
### 좋아요
### 리뷰

## 진효겸
### 회원
### 검색

